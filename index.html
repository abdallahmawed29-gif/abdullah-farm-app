<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Abdullah Farm App</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body{font-family: Tahoma, Arial; direction: rtl; padding:16px; background:#f8f9fa; color:#222;}
    h1{margin-top:0;color:#165c3b;}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.06);margin-bottom:12px;}
    label{display:block;margin-top:8px;}
    select,input,textarea{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;}
    button{background:#2e7d32;color:#fff;border:none;padding:10px 12px;border-radius:6px;cursor:pointer;margin-top:8px;}
    #preview{max-width:100%;border-radius:6px;margin-top:8px;}
    .small{font-size:13px;color:#555;}
    .symp{display:inline-block;padding:6px 8px;margin:6px;border-radius:20px;background:#eef6ee;cursor:pointer;border:1px solid #cfe8cf;}
    .symp.selected{background:#2e7d32;color:#fff;border-color:#2e7d32;}
    .flex{display:flex;gap:8px;}
    .col{flex:1;}
    footer{font-size:13px;color:#666;margin-top:16px;text-align:center;}
  </style>
</head>
<body>
  <h1>ุชุทุจูู ุนุจุฏุงููู ุงูุฒุฑุงุนู ๐จโ๐พ</h1>
  <div class="card">
    <strong>ูุฑุญุจูุง!</strong>
    <p class="small">ูุณุฎุฉ ูุจุฏุฆูุฉ ูุชูุฏูุฉ: ุจุฑุงูุฌ ุชุณููุฏ ููู ูุญุตูู + ุฑูุน ุตูุฑุฉ ูุชุดุฎูุต ูุจุฏุฆู ูุนุชูุฏ ุนูู ุงูุฃุนุฑุงุถุ ูุชูุงุฑูุฑ ุฌุงูุฒุฉ ุจุงุณู ุงููููุฏุณ ุนุจุฏุงููู.</p>
  </div>

  <div class="card">
    <label>ุงุฎุชุฑ ุงููุญุตูู</label>
    <select id="crop"></select>

    <label>ุฃุฏุฎู ุนูุฑ ุงููุจุงุช ุจุงูุฃูุงู</label>
    <input type="number" id="age" placeholder="ูุซุงู: 35">

    <button onclick="showProgram()">ุนุฑุถ ุจุฑูุงูุฌ ุงูุชุณููุฏ</button>
    <div id="program" class="small" style="margin-top:10px;"></div>
  </div>

  <div class="card">
    <h3>ุฑูุน ุตูุฑุฉ ููุชุดุฎูุต</h3>
    <input type="file" accept="image/*" id="imgfile">
    <img id="preview" style="display:none">

    <div id="symptoms" style="margin-top:10px;display:none;">
      <div class="small">ุงุฎุชุฑ ุงูุฃุนุฑุงุถ ุงูุธุงูุฑุฉ ุนูู ุงูุตูุฑุฉ (ูููู ุชุฎุชุงุฑ ุฃูุซุฑ ูู ูุงุญุฏ):</div>
      <div id="symplist" style="margin-top:8px"></div>
      <button onclick="diagnose()">ุงุนุฑู ุงูุชุดุฎูุต</button>
    </div>

    <div id="diagnosis" style="margin-top:10px;"></div>
  </div>

  <div class="card">
    <h3>ุชูุฑูุฑ ูููุงุญุธุงุช ุงููููุฏุณ</h3>
    <label>ููุงุญุธุงุช ุฅุถุงููุฉ (ูุณุจูุฉ ุจุงุณู ุงููููุฏุณ ุนุจุฏุงููู)</label>
    <textarea id="engnotes" rows="4">ุชูููุน: ุงููููุฏุณ ุนุจุฏุงููู. โ ููุงุญุธุงุช ูููุฉ: ุงูุญุต ุงูุญูู ููุฏุงูููุง ูุจู ุงุชุฎุงุฐ ูุฑุงุฑ. ููุชูุงุตู: +20XXXXXXXXX</textarea>
    <div class="flex" style="margin-top:8px;">
      <button onclick="downloadReport()">ุญูุธ ุชูุฑูุฑ (TXT)</button>
      <button onclick="copyReport()">ูุณุฎ ุงูุชูุฑูุฑ ููุญุงูุธุฉ</button>
    </div>
    <div id="saved" class="small"></div>
  </div>

  <footer class="small">ูุฐู ูุณุฎุฉ MVP: ุงูุชุดุฎูุต ูุจุฏุฆู ูุนุชูุฏ ุนูู ุงุฎุชูุงุฑ ุงูุฃุนุฑุงุถุ ูุงุญููุง ูููู ุฑุจุทูุง ุจูููุฐุฌ AI ูุฏุฑุจ ุนูู ุตูุฑ ุญูููุฉ.</footer>

<script>
const data = {
  "ููุญ": {"stages":[{"day":15,"note":"ุชุณููุฏ ููุชุฑูุฌูู N 20-30 ูุฌู/ูุฏุงู ูู ูุฑุญูุฉ ุงูููู ุงููุจูุฑ."},{"day":60,"note":"ุชุณููุฏ ููุชุฑูุฌูู 20-30 ูุฌู/ูุฏุงู ูุจู ุงูุฅุฒูุงุฑ."},{"day":90,"note":"ุชุณููุฏ ูุณููุฑ ูุจูุชุงุณููู ูุจู ุงูุชูููู."}]},
  "ุฐุฑุฉ": {"stages":[{"day":14,"note":"ุฅุถุงูุฉ ููุณููุฑ ูุชุนุฒูุฒ ุงูุฌุฐูุฑ."},{"day":40,"note":"ุชุณููุฏ ููุชุฑูุฌูู ุจุฌุฑุนุงุช ููุณูุฉ."},{"day":70,"note":"ุจูุชุงุณููู ูุจู ุฃูุชูุงู ุงูุญุจูุจ."}]},
  "ุจุทุงุทุณ": {"stages":[{"day":20,"note":"ุฑุดุฉ ูุชุฑุงุช ุฃุซูุงุก ุงูุชุฒููุฑ."},{"day":50,"note":"ุจูุชุงุณููู ูุฒูุงุฏุฉ ุญุฌู ุงูุฏุฑูุงุช."}]},
  "ูุฑุงููุฉ": {"stages":[{"day":10,"note":"ุชุณููุฏ ูุฑูู ูุชูุงุฒู."},{"day":30,"note":"ูุฑุงูุจุฉ ุงููุทุฑูุงุช ูุงูุฑุด ุงูููุงุฆู."}]},
  "ุจุทูุฎ": {"stages":[{"day":15,"note":"ููุณููุฑ ููุชุซุจูุช ุงูุฌุฐุฑู."},{"day":45,"note":"ุจูุชุงุณููู ูุฒูุงุฏุฉ ุงูุณูุฑ."}]},
  "ุดูุงู": {"stages":[{"day":15,"note":"ููุณููุฑ ูุจูุฑ."},{"day":40,"note":"ุจูุชุงุณููู ูุจู ูุถุฌ ุงูุซูุงุฑ."}]},
  "ูุงูุฌู": {"stages":[{"day":30,"note":"ุชุณููุฏ ูุชูุงุฒู ูุจู ุงูุชุฒููุฑ."},{"day":120,"note":"ุชุบุฐูุฉ ุจุนุฏ ุงูุญุตุงุฏ ููุชุนุงูู."}]},
  "ููุงูุญ": {"stages":[{"day":30,"note":"ุชุณููุฏ ููุชุฑูุฌูู ูุชูุงุฒู ุจุนุฏ ุงูุนูุฏ."},{"day":90,"note":"ุจูุชุงุณููู ูุชุญุณูู ุงูุฌูุฏุฉ."}]},
  "ุทูุงุทู": {"stages":[{"day":15,"note":"ุชุณููุฏ ูุณููุฑ ูู ุจุฏุงูุฉ ุงูุฒุฑุงุนุฉ."},{"day":45,"note":"ุชุณููุฏ ุจูุชุงุณููู ุฃุซูุงุก ุงูุนูุฏ."}]},
  "ูููู": {"stages":[{"day":20,"note":"ููุชุฑูุฌูู ูุนุชุฏู ูุจู ุงูุชุฒููุฑ."},{"day":50,"note":"ุจูุชุงุณููู ูุชุญุณูู ุญุฌู ุงูุซูุงุฑ."}]},
  "ูุงุตูููุง ุฎุถุฑุงุก": {"stages":[{"day":15,"note":"ุชุณููุฏ ููุณููุฑ ูููุณุงุนุฏุฉ ุนูู ุงูุชุฒููุฑ."},{"day":35,"note":"ูููู ูู ุงูููุชุฑูุฌูู ุฅู ูุฒู."}]},
  "ููู ุณูุฏุงูู": {"stages":[{"day":20,"note":"ุชุณููุฏ ูุณููุฑ ูุจูุฑ."},{"day":80,"note":"ุชุญุณูู ุงูุชูููุฉ ูุงูุชุฌููู ูุจู ุงูุญุตุงุฏ."}]}
};

const cropSelect = document.getElementById('crop');
Object.keys(data).forEach(c=>{
  const opt = document.createElement('option');
  opt.value = c; opt.textContent = c;
  cropSelect.appendChild(opt);
});

function showProgram(){
  const crop = cropSelect.value;
  const age = parseInt(document.getElementById('age').value || '0');
  const programDiv = document.getElementById('program');
  if(!data[crop]){ programDiv.innerText = 'ูุง ููุฌุฏ ุจุฑูุงูุฌ ููุฐุง ุงููุญุตูู ุจุนุฏ.'; return; }
  let lines = 'ุจุฑูุงูุฌ ุงูุชุณููุฏ ุงูููุชุฑุญ (ูุจุณุท):\n';
  data[crop].stages.forEach(s=>{
    const due = age >= s.day ? 'ูุงุถู ุฃู ูุณุชุญู ุงูุขู' : 'ูุณุชูุจูู';
    lines += `ุจุนุฏ ${s.day} ููู - ${s.note} (${due})\n`;
  });
  programDiv.innerText = lines;
  programDiv.style.whiteSpace = 'pre-line';
}

const imgfile = document.getElementById('imgfile');
const preview = document.getElementById('preview');
const sympDiv = document.getElementById('symptoms');
const sympList = document.getElementById('symplist');
const diagnosisDiv = document.getElementById('diagnosis');

const symptoms = [
  "ุจูุน ุจููุฉ/ูุงุฆูุฉ ุนูู ุงููุฑูุฉ",
  "ุงุตูุฑุงุฑ ุนุงู ูููุจุงุช (Chlorosis)",
  "ุฐุจูู ูุฌุงุฆู",
  "ุซููุจ/ุฃูู ุงูุญูุงู (ุขูุงุช ุญุดุฑูุฉ)",
  "ุจูุน ุบุฑููุฉ ุนูู ุงูุซูุงุฑ (ุชุนูู)",
  "ุชุฌุนุฏ ูุชุดูู ุงูุฃูุฑุงู",
  "ุจูุน ุจูุถุงุก/ุจูุฏุฑุฉ (ูุทุฑูุงุช)",
  "ุฌุฐูุฑ ูุชุญููุฉ/ุฑุงุฆุญุฉ"
];

symptoms.forEach(s=>{
  const el = document.createElement('span');
  el.className = 'symp';
  el.innerText = s;
  el.onclick = ()=> el.classList.toggle('selected');
  sympList.appendChild(el);
});

imgfile.onchange = function(e){
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  preview.src = url;
  preview.style.display = 'block';
  sympDiv.style.display = 'block';
  diagnosisDiv.innerHTML = '';
}

function diagnose(){
  const selected = Array.from(document.querySelectorAll('.symp.selected')).map(s=>s.innerText);
  if(selected.length === 0){ alert('ุงุฎุชุงุฑ ุนุฑุถ ุฃู ุฃูุซุฑ ุนูุดุงู ูุญุงูู ูุดุฎุต ุงููุดููุฉ.'); return; }
  let result = 'ุชุดุฎูุต ูุจุฏุฆู:\n';
  let recommendations = [];

  if(selected.includes('ุจูุน ุจูุถุงุก/ุจูุฏุฑุฉ (ูุทุฑูุงุช)')){
    result += '- ุงุญุชูุงููุฉ ูุฌูุฏ ูุทุฑูุงุช ุณุทุญูุฉ (ูุซู ุงูุจูุงุถ ุงูุฏูููู).\n';
    recommendations.push('ุฑุด ูุจูุฏ ูุทุฑู ููุงุณุจ ุฃู ูุญููู ูุจุฑูุช ุฃู ููุชุฌุงุช ุญูููุฉ ูุถุงุฏุฉ ูููุทุฑูุงุช.');
  }
  if(selected.includes('ุจูุน ุจููุฉ/ูุงุฆูุฉ ุนูู ุงููุฑูุฉ')){
    result += '- ูุฏ ุชููู ุจูุน ูุงุฌูุฉ ุนู ูุทุฑูุงุช ุฃู ุจูุชูุฑูุง (ุชุนูู ุจูุชูุฑู/ูุทุฑู).\n';
    recommendations.push('ุงูุนุฒู ุงูุฃูุงูู ุงููุตุงุจุฉุ ูุฑุด ูุจูุฏ ููุงุณุจ ูุงุชูุจุน ุชุนูููุงุช ุงูุณูุงูุฉ.');
  }
  if(selected.includes('ุงุตูุฑุงุฑ ุนุงู ูููุจุงุช (Chlorosis)')){
    result += '- ูุฏ ูุดูุฑ ูููุต ุนูุงุตุฑ (ููุต ููุชุฑูุฌูู ุฃู ุญุฏูุฏ) ุฃู ููุดููุฉ ุฑู.\n';
    recommendations.push('ุงูุญุต ูุณุชูู pH ูุงูุชุฑุจุฉุ ูููุฑ ูู ุชุณููุฏ N ุฃู Fe ุญุณุจ ุงูุชุญููู.');
  }
  if(selected.includes('ุฐุจูู ูุฌุงุฆู')){
    result += '- ูููู ูููู ุฐุจูู ุฌุฑุซูููุ ูุทุฑูุ ุฃู ูุชูุฌุฉ ููุต ููุงู/ุฌุฐูุฑ ูุชุถุฑุฑุฉ.\n';
    recommendations.push('ุชุญูู ูู ุงูุฑู ูุงูุฌุฐูุฑ ูุงุณุชุฎุฏู ูุจูุฏุงุช ุฃู ุญููู ุจููููุฌูุฉ ุญุณุจ ุงูุญุงูุฉ.');
  }
  if(selected.includes('ุซููุจ/ุฃูู ุงูุญูุงู (ุขูุงุช ุญุดุฑูุฉ)')){
    result += '- ูุฌูุฏ ุขูุงุช ุญุดุฑูุฉ (ุฏูุฏุงูุ ุญุดุฑุงุช ูุงุฑุถุฉ).\n';
    recommendations.push('ุงุณุชุฎุฏู ูุจูุฏุงุช ุญุดุฑูุฉ ูุณุชูุฏูุฉ ุฃู ูุตุงุฆุฏ ูุฎุทุฉ ููุงูุญุฉ ูุชูุงููุฉ (IPM).');
  }
  if(selected.includes('ุฌุฐูุฑ ูุชุญููุฉ/ุฑุงุฆุญุฉ')){
    result += '- ูุดุงูู ุฌุฐูุฑ (ูููุงุชูุฏุง ุฃู ุชุนูู ุฌุฐูุฑ).\n';
    recommendations.push('ุงูุญุต ุงูุชุฑุจุฉุ ูููุฑ ูู ูุนุงููุงุช ุชุนููู ููุชุฑุจุฉ ุฃู ูุจูุฏุงุช ูููุงุชูุฏุง ุฃู ุญููู ุญูููุฉ.');
  }

  recommendations.push('ูุจู ุงุณุชุฎุฏุงู ุฃู ููุชุฌ ุชุฃูุฏ ูู ูุฑุงุกู ุงูููุญุฉ ุงูุฅุฑุดุงุฏูุฉ ูุฌุฑุนุงุช ุงูุงุณุชุฎุฏุงู.');

  diagnosisDiv.innerHTML = '<pre style="white-space:pre-line;">' + result + '\nุงูุชูุตูุงุช:\n- ' + recommendations.join('\n- ') + '</pre>';

  const crop = document.getElementById('crop').value;
  const age = document.getElementById('age').value || 'ุบูุฑ ูุญุฏุฏ';
  document.getElementById('engnotes').value = `ุชูุฑูุฑ ูุจุฏุฆู\nุงููุญุตูู: ${crop}\nุนูุฑ ุงููุจุงุช: ${age} ููู\n${result.replace(/\n/g,'\n')}\nุชูุตูุงุช:\n- ${recommendations.join('\n- ')}\n\nุชูููุน: ุงููููุฏุณ ุนุจุฏุงููู. ููุชูุงุตู: +20XXXXXXXXX`;
}

function downloadReport(){
  const notes = document.getElementById('engnotes').value;
  const crop = document.getElementById('crop').value;
  const age = document.getElementById('age').value || 'ุบูุฑ ูุญุฏุฏ';
  const now = new Date().toLocaleString('ar-EG');
  const content = `Abdullah Farm App - ุชูุฑูุฑ ููุฏุงูู\nุงูุชุงุฑูุฎ: ${now}\nุงููุญุตูู: ${crop}\nุนูุฑ ุงููุจุงุช: ${age} ููู\n\n${notes}`;
  const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `report_${crop.replace(/\s+/g,'_')}_${Date.now()}.txt`;
  document.body.appendChild(a); a.click();
  a.remove();
  document.getElementById('saved').innerText = 'ุชู ุชูุฒูู ุงูุชูุฑูุฑ ุนูู ุฌูุงุฒู.';
}

function copyReport(){
  const notes = document.getElementById('engnotes').value;
  navigator.clipboard.writeText(notes).then(()=>{
    document.getElementById('saved').innerText = 'ุชู ูุณุฎ ุงูุชูุฑูุฑ ููุญุงูุธุฉ.';
  }).catch(()=>{
    document.getElementById('saved').innerText = 'ุงููุณุฎ ูู ููุฌุญ - ุงูุชุญ ุงููุชุตูุญ ุงููุณููุญ.';
  });
}

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js').catch(()=>{});
}
</script>
</body>
</html>
